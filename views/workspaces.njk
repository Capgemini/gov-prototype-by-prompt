{% extends "template.njk" %}

{% block pageTitle %}
  Your workspaces â€“ Gov Prototype by Prompt
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">Your workspaces</h1>
      <p class="govuk-body">
        {% if totalWorkspaces != 0 %}
          There {{ 'are' if totalWorkspaces != 1 else 'is' }} {{ totalWorkspaces }} workspace{{ 's' if totalWorkspaces != 1 else '' }}.
        {% else %}
          There are no workspaces.
        {% endif %}
      </p>
      {{ govukButton({
        text: "Create a workspace",
        href: "/user/workspace/create"
      }) }}
      {% if totalWorkspaces > 0 %}
        {{ govukTable({
          firstCellIsHeader: true,
          head: header,
          rows: workspaceRows
        }) }}
        {% if showPagination %}
          {{ govukPagination({
            classes: "justify-self-center",
            previous: {
              href: paginationPreviousHref
            },
            next: {
              href: paginationNextHref
            },
            items: paginationItems
          }) }}
        {% endif %}
        {{ govukRadios({
          classes: "govuk-radios--inline govuk-radios--small",
          id: "itemsPerPage",
          name: "itemsPerPage",
          fieldset: {
            legend: {
              text: "Items per page",
              isPageHeading: false
            }
          },
          items: perPageItems
        }) }}
      {% endif %}
    </div>
  </div>
{% endblock %}

{% block bodyEnd %}
  {# Run JavaScript at end of the <body>, to avoid blocking the initial render. #}
  {{ super() }}
  <script>
    // Reload the page if the user navigates back
    // This makes sure the submit button is re-enabled
    window.addEventListener("pageshow", function(event) {
      const historyTraversal = event.persisted || 
                            (typeof window.performance != "undefined" && 
                            window.performance.navigation.type === 2);
      if (historyTraversal) {
        window.location.reload();
      }
    });

    document.addEventListener('DOMContentLoaded', async function() {

      const radios = document.querySelectorAll('input[name="itemsPerPage"]');

      // Handle the click event for the itemsPerPage radio input
      radios.forEach(radio => {
        radio.addEventListener('click', function(event) {

          // Get the value
          const itemsPerPageRadioValue = document.querySelector('input[name="itemsPerPage"]:checked').value;
          
          // Redirect to the same page with the selected filter
          const url = new URL(window.location.href);
          url.searchParams.set('page', '1'); // Reset to the first page
          url.searchParams.set('perPage', itemsPerPageRadioValue);
          window.location.href = url.toString();
        });
      });
    });
  </script>
{% endblock %}