{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "type": "object",
    "additionalProperties": false,
    "required": [
        "explanation",
        "title",
        "description",
        "duration",
        "before_you_start",
        "what_happens_next",
        "form_type",
        "show_progress_indicators",
        "questions"
    ],
    "properties": {
        "explanation": {
            "type": ["string", "null"],
            "description": "A concise, specific explanation of why you, as the LLM, generated the form in this way. Clearly state any assumptions, inferred requirements, or data you generated that was not present in the user prompt. Do not repeat information already provided elsewhere in the form. If updating an existing form, only explain the changes made. Write in the first person for yourself, the second person for the prompt creator, and the third person for the form user. For example, 'I assumed that the user will need to provide their name, address, and date of birth, and that they must be at least 18 years old.' or 'I have added a multiple choice question to allow the user to select their preferred contact methods.'"
        },
        "changes_made": {
            "type": "string",
            "description": "A single, concise summary (max 80 characters, no full stop) of the specific change(s) you, as the LLM, made to the form. For example, 'Removed email address question' or 'Added a question about preferred contact method'"
        },
        "suggestions": {
            "type": ["array", "null"],
            "description": "A list of three unique, specific, and actionable suggestions for improving the form. Each suggestion must be a direct instruction to add, update, or remove a question. Phrase each as a clear command. For example, 'Add a question about the user's preferred contact method' or 'Ensure the user is at least 18 years old in question 5.'",
            "items": {
                "type": "string",
                "minItems": 3,
                "maxItems": 3,
                "description": "A single suggestion for improving the form. This must be very concise, direct, and specific."
            }
        },
        "title": {
            "type": "string",
            "description": "A concise, plain-text title describing the purpose of the form. Use sentence case and do not include a full stop. For example, 'Register to vote' or 'Apply for a driving licence'."
        },
        "description": {
            "type": "string",
            "description": "A Markdown-formatted description shown below the title, providing clear context or instructions for filling out the form. Do not use headings."
        },
        "duration": {
            "type": "integer",
            "description": "The typical time, in minutes, required to complete the form."
        },
        "before_you_start": {
            "type": "string",
            "description": "A Markdown-formatted description of what the user should know or do before starting the form. Clearly state any eligibility criteria or prerequisites. Do not use headings. For example, 'You must be a British citizen and have a valid National Insurance number to use this service.'"
        },
        "what_happens_next": {
            "type": "string",
            "description": "A Markdown-formatted description of what happens after the user submits the form. Clearly explain the next steps. Do not use headings. For example, 'We've sent your submission to [Hackney Electoral Register Office](https://hackney.gov.uk). They will contact you either to confirm your registration, or to ask for more information.'"
        },
        "form_type": {
            "type": "string",
            "description": "A single word describing the type of form. This word should make sense when used in the phrase '[form_type] complete' after the user finishes the form. For example, 'registration' or 'application'."
        },
        "show_progress_indicators": {
            "type": "boolean",
            "description": "Whether to show progress indicators (e.g., 'Question 1 of 3') as the user completes the form. Default to true unless the form contains a branching_choice question or the user requests otherwise."
        },
        "questions": {
            "type": "array",
            "description": "An array of the form questions. A question typically consists of a question title, some optional hint text and one or more form fields.",
            "items": {
                "type": "object",
                "required": [
                    "question_text",
                    "hint_text",
                    "detailed_explanation",
                    "required",
                    "required_error_text",
                    "answer_type",
                    "options",
                    "date_of_birth_minimum_age",
                    "date_of_birth_maximum_age",
                    "next_question_value",
                    "options_branching"
                ],
                "additionalProperties": false,
                "properties": {
                    "question_text": {
                        "type": "string",
                        "description": "A full-sentence question title ending with a question mark. If the question is optional, append '(optional)'. For example, 'What is your name?' or 'What is your date of birth?'"
                    },
                    "hint_text": {
                        "type": ["string", "null"],
                        "description": "A short, single-sentence hint (no full stops) to help users answer the question, such as where to find information or how it will be used. This must be null if detailed_explanation is provided. For example, 'Tick the box or boxes that apply'."
                    },
                    "detailed_explanation": {
                        "type": ["object", "null"],
                        "description": "A detailed explanation of the question. This should normally be null unless the question needs more context or instructions. The title must be a string in sentence case as a statement (for example, 'Interview needs'). The explanation must be a string in Markdown and may include multiple sentences or paragraphs. The hint text must be null if this is provided.",
                        "properties": {
                            "question_title": {
                                "type": "string",
                                "description": "A sentence-case statement as a title for the whole question. An example is 'Interview needs' or 'Vehicle transmission'."
                            },
                            "explanation_text": {
                                "type": "string",
                                "description": "Markdown-formatted, may include multiple sentences or paragraphs."
                            }
                        },
                        "required": ["question_title", "explanation_text"],
                        "additionalProperties": false
                    },
                    "required": {
                        "type": "boolean",
                        "description": "Whether the question is required to be answered. If true, the user must provide an answer before submitting the form and the question must not be marked as optional in the question_text. If false, the user can leave the question blank and it is considered optional."
                    },
                    "required_error_text": {
                        "type": ["string", "null"],
                        "description": "A plain English error message shown if a required question is left unanswered. Be direct and concise. Leave as null if the question is not required. For example, 'Enter how many hours you work a week'."
                    },
                    "next_question_value": {
                        "type": ["integer", "null"],
                        "description": "The index (starting from 1) of the next question in the form sequence. This should normally be the next question number. Use -1 if the user should finish the form with no further questions. This cannot be larger than the total number of questions in the form. Leave as null for branching_choice answer types."
                    },
                    "answer_type": {
                        "type": "string",
                        "description": "The type of answer required, based on what the question is asking. Must be one of the allowed enum values.",
                        "enum": [
                            "address",
                            "bank_details",
                            "country",
                            "date",
                            "date_of_birth",
                            "email",
                            "emergency_contact_details",
                            "file_upload",
                            "gbp_currency_amount",
                            "multiple_choice",
                            "name",
                            "national_insurance_number",
                            "nationality",
                            "passport_information",
                            "phone_number",
                            "single_choice",
                            "branching_choice",
                            "tax_code",
                            "text",
                            "text_area",
                            "vat_registration_number"
                        ]
                    },
                    "options": {
                        "type": ["array", "null"],
                        "description": "For single_choice or multiple_choice questions, an array of unique options. Leave as null for other answer types.",
                        "items": {
                            "type": "string",
                            "minItems": 2,
                            "description": "Option text displayed to the user and submitted with the form."
                        }
                    },
                    "options_branching": {
                        "type": ["array", "null"],
                        "description": "For branching_choice questions, an array of options with associated next_question_value. Leave as null for other answer types.",
                        "items": {
                            "type": "object",
                            "required": ["text_value", "next_question_value"],
                            "additionalProperties": false,
                            "properties": {
                                "text_value": {
                                    "type": "string",
                                    "description": "Option text displayed to the user and submitted with the form."
                                },
                                "next_question_value": {
                                    "type": "integer",
                                    "description": "The number of the next question to jump to (starting from 1) if this option requires additional information or if the form continues after this option. Use -1 if the user should finish the form with no further questions. This cannot be larger than the total number of questions in the form."
                                }
                            }
                        }
                    },
                    "date_of_birth_minimum_age": {
                        "type": ["integer", "null"],
                        "multipleOf": 1,
                        "minimum": 0,
                        "description": "The minimum age in years for date_of_birth questions. Leave as null if not applicable."
                    },
                    "date_of_birth_maximum_age": {
                        "type": ["integer", "null"],
                        "multipleOf": 1,
                        "minimum": 0,
                        "description": "The maximum age in years for date_of_birth questions. Leave as null if not applicable."
                    }
                }
            }
        }
    }
}
